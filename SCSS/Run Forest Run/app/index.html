<!DOCTYPE html>
<!--
    All Rights Reserved
    This software is proprietary information of
    Intelligent Sense
    Use is subject to license terms.
    Filename: index.html
-->
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width" />
    <title></title>
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js"></script>
</head>


<body>
    <!-- build:remove -->
    <span id="browser-sync-binding"></span>
    <!-- endbuild -->



    <!--Mustache-->
    <div class="header">
        <img class="header__logo" src="img/logo.png">
        <img class="header__menu" src="img/menu.png">
        <nav class="header__nav">
            <ul class="header__nav__items">
                <li><a href="#">Directorios de agentes</a></li>
                <li><a href="#">Contacto</a></li>
                <li><a href="#">Ingresar</a></li>
            </ul>
        </nav>
    </div>
    <div class="cover">
    </div>
    <div class="search">
        <h1 class="search__title">Los Mejores agentes de seguridad</h1>
        <input class="search__input" type="search" placeholder="Buscar por Ubicacion">
        <img class="search__image" src="img/lupa.png">
    </div>
    <div class="agent-container" id="agent-container">
        <script type="mustache/x-tmpl" id="agent-tmpl">
            {{#companies}}
                <div class="agent-container__agent-item">
                    <div class="agent-container__agent-item__header">
                        <h2 class="agent-container__agent-item__header__agent-name">{{name}}</h2>
                        {{#isCertified}}
                            <img src="img/certified.png">
                        {{/isCertified}}
                    </div>
                    <div class="agent-container__agent-item__body">
                        <img src="img/imagechuck.png">
                        <p class="agent-container__agent-item__body__agent-description">{{description}}</p>
                    </div>
                    <div class="agent-container__agent-item__footer">
                        <h2 class="agent-container__agent-item__footer__price-description">Desde: ${{rate}} {{hours}}/hrs</h2>
                        <button class="agent-container__agent-item__footer__btn-buy" type="button">Contratar</button>
                    </div>
                </div>
            {{/companies}}
        </script>

        <script>
            //Create Promise
            var insert_agent = new Promise((resolve, reject) => {
                const request = new XMLHttpRequest();
                request.onreadystatechange = function () {
                    if (this.status === 200 && this.readyState == 4) { //200 means that the request has succeeded.
                        resolve(request.response);
                    }
                }
                request.open('GET', 'https://api.myjson.com/bins/uptto', true);
                request.send();
            });
            var tmpl = document.getElementById("agent-tmpl").innerHTML;
            //Consume Promise
            var obtain_agent = function () {
                insert_agent
                    .then(function(data) {
                        var box = document.getElementById("agent-container");
                        var html = Mustache.to_html(tmpl, JSON.parse(data));
                        box.innerHTML = html;
                    }).catch((error) => {
                        console.log(error.message);
                    });
            }
            obtain_agent();


        </script>


    </div>


    <script>

        const promise = new Promise((resolve, reject) => {
            const request = new XMLHttpRequest();
            request.open('GET', 'https://api.myjson.com/bins/uptto', true);
            request.onload = () => {
                if (request.status === 200) { //200 means that the request has succeeded.
                    resolve(request.response);
                    console.log(request.response);
                } else {
                    reject(Error(request.statusText));
                }
            }
        });

        promise.then((data) => {
            console.log('Got data! Promise fulfilled.');
            document.body.textContent = JSON.parse(data).companies.name;
        }, (error) => {
            console.log('Promise reject');
            console.log(error.message);
        });
    </script>


    <footer class="footer">
        <p class="footer__develop">Desarrollado por Akurey.com Todos los derechos reservados.</p>
        <h5 class="footer__terms">TÃ©rminos y Condiciones</h5>
    </footer>


    <script src="js/vendor/jquery-1.10.1.min.js"></script>
    <script src="js/main.js"></script>



    <!-- Live reload option. Remove in production environments -->
    <!-- <script src="//localhost:35729/livereload.js"></script>-->
</body>

</html>

<!--https://davidwalsh.name/write-javascript-promises-->